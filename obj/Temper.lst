C251 COMPILER V5.60.0,  Temper                                                             14/03/23  10:23:45  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE Temper
OBJECT MODULE PLACED IN .\obj\Temper.obj
COMPILER INVOKED BY: D:\KeilMDK\C251\BIN\C251.EXE Temperaturn\Temper.c XSMALL INTR2 OPTIMIZE(0,SPEED) BROWSE INCDIR(.\Ad
                    -s1110;.\Flash;.\mcp4725;.\IIC;.\MwPro;.\Uart;.\Lcd;.\ModBus;.\Temperaturn) PRINT(.\obj\Temper.lst) OBJECT(.\obj\Temper.o
                    -bj) 

stmt  level    source

    1          #include "main.h"
    2          #include "Temper.h"
    3          #include "Lcd.h"
    4          #include "LcdApp.h"
    5          #include "uart.h"
    6          
    7          uint TEMPER = 0;
    8          uint TEMPER_Val;
    9          
   10          
   11          //上为ADC采样值，下方左为温度值，右为数组标号
   12          uint code temp_table[]={
   13          
   14              140,      149,    159,    168,    178,    188,
   15              //-40 0   -39 1   -38 2   -37 3   -36 4   -35 5
   16              199,      210,    222,    233,    246,    259,
   17              //-34 6   -33 7   -32 8   -31 9   -30 10  -29 11
   18              272,      286,    301,    317,    333,    349, 
   19              //-28 12  -27 13  -26  14 -25  15 -24  16 -23  17
   20              367,      385,    403,    423,    443,    464,
   21              //-22 18  -21 19  -20 20  -19 21  -18 22  -17 23
   22              486,      509,    533,    558,    583,    610,  
   23              //-16 24  -15 25  -14 26  -13 27  -12 28  -11 29
   24              638,      667,    696,    727,    758,    791,
   25              //-10 30  -9  31  -8  32  -7  33  -6  34  -5  35
   26              824,      858,    893,    929,    965,    1003, 
   27              //-4  36  -3  37  -2  38  -1  39  0   40  1   41
   28              1041,     1080,   1119,   1160,   1201,   1243,
   29              //2   42  3   43  4   44  5   45  6   46  7   47
   30              1285,     1328,   1371,   1414,   1459,   1503,
   31              //8   48  9   49  10  50  11  51  12  52  13  53
   32              1548,     1593,   1638,   1684,   1730,   1775,
   33              //14  54  15  55  16  56  17  57  18  58  19  59
   34              1821,     1867,   1912,   1958,   2003,   2048,
   35              //20  60  21  61  22  62  23  63  24  64  25  65
   36              2093,     2137,   2182,   2225,   2269,   2312,
   37              //26  66  27  67  28  68  29  69  30  70  31  71
   38              2354,     2397,   2438,   2479,   2519,   2559,
   39              //32  72  33  73  34  74  35  75  36  76  37  77
   40              2598,     2637,   2675,   2712,   2748,   2784,
   41              //38  78  39  79  40  80  41  81  42  82  43  83
   42              2819,     2853,   2887,   2920,   2952,   2984,
   43              //44  84  45  85  46  86  47  87  48  88  49  89
   44              3014,     3044,   3073,   3102,   3130,   3157,
   45              //50  90  51  91  52  92  53  93  54  94  55  95
   46              3183,     3209,   3234,   3259,   3283,   3306,
   47              //56  96  57  97  58  98  59  99  60  100 61  101
   48              3328,     3351,   3372,   3393,   3413,   3432,
   49              //62  102 63  103 64  104 65  105 66  106 67  107
   50              3452,     3470,   3488,   3506,   3523,   3539,
   51              //68  108 69  109 70  110 71  111 72  112 73  113
   52              3555,     3571,   3586,   3601,   3615,   3628,
   53              //74  114 75  115 76  116 77  117 78  118 79  119
   54              3642,     3655,   3667,   3679,   3691,   3702, 
   55              //80  120 81  121 82  122 83  123 84  124 85  125
   56              3714,     3724,   3735,   3745,   3754,   3764,
   57              //86  126 87  127 88  128 89  129 90  130 91  131
C251 COMPILER V5.60.0,  Temper                                                             14/03/23  10:23:45  PAGE 2   

   58              3773,     3782,   3791,   3799,   3807,   3815,
   59              //92  132 93  133 94  134 95  135 96  136 97  137
   60              3822,     3830,   3837,   3844,   3850,   3857, 
   61              //98  138 99  139 100 140 101 141 102 142 103 143
   62              3863,     3869,   3875,   3881,   3887,   3892,
   63              //104 144 105 145 106 146 107 147 108 148 109 149
   64              3897,     3902,   3907,   3912,   3917,   3921,
   65              //110 150 111 151 112 152 113 153 114 154 115 155
   66              3926,     3930,   3934,   3938,   3942 
   67              //116 156 117 157 118 158 119 159 120 160
   68              };
   69          
   70          void Adc_Init()
   71          {
   72   1          P_SW2 |= 0x80;
   73   1          ADCTIM = 0x3f;      //设置 ADC 内部时序，ADC采样时间建议设最大值
   74   1          ADCCFG = 0x2f;      //设置 ADC 时钟为系统时钟/2/16/16
   75   1          ADC_CONTR = 0x80;   //使能 ADC 模块
   76   1          _nop_();
   77   1          _nop_();
   78   1          
   79   1      }
   80          
   81          
   82          int Get_Temperature(uint adc)
   83          {
   84   1          int i;
   85   1          uint code *p;
   86   1          p = temp_table;
   87   1          if((adc >= p[0]) && (adc <= p[160]))
   88   1          {
   89   2              for(i=0;i<160;i++)
   90   2              {
   91   3                  if(adc <= p[i])
   92   3                  {
   93   4                      i = i-1;
   94   4                      return (i - 40);
   95   4                  }
   96   3              }
   97   2          }
   98   1          return (-40);
   99   1      
  100   1      }
  101          
  102          uint Get_ADC12bitResult(u8 channel)  //channel = 0~15
  103          {
  104   1          uint tem = 0;
  105   1          ADC_RES = 0;
  106   1          ADC_RESL = 0;
  107   1      
  108   1          ADC_CONTR = (ADC_CONTR & 0xe0) | 0x40 | channel;    //启动 AD 转换
  109   1          _nop_();
  110   1          _nop_();
  111   1          _nop_();
  112   1          _nop_();
  113   1          _nop_();
  114   1          
  115   1          while(!ADC_FLAG)
  116   1      
  117   1          {
  118   2              ;
  119   2          }
  120   1          ADC_FLAG = 0;   //清除ADC结束标志
  121   1          tem = ((uint)(ADC_RES << 8)) | ADC_RESL ;
  122   1          return  tem;
  123   1      }
C251 COMPILER V5.60.0,  Temper                                                             14/03/23  10:23:45  PAGE 3   

  124          
  125          
  126          void ADC_Temp()
  127          {
  128   1          TEMPER= Get_ADC12bitResult(4);  //参数0~15,查询方式做一次ADC, 返回值就是结果, == 4096 为错误
  129   1          
  130   1          TEMPER =  Get_Temperature(TEMPER); //计算温度值
  131   1      
  132   1          TEMPER *= 10; 
  133   1          TEMPER_Val =TEMPER;
  134   1          ShowTemp(TEMPER_Val);
  135   1      
  136   1          if(TEMPER_Val > 300)
  137   1          {
  138   2              FANS_M(1);
  139   2          }
  140   1          if(TEMPER_Val < 260)
  141   1          {
  142   2              FANS_M(0);
  143   2          }
  144   1      }
  145          
  146          
  147          
  148          
  149          
  150          
  151          
  152          
  153          
  154          
  155          
  156          
  157          
  158          
  159          
  160          
  161          
  162          
  163          
  164          
  165          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       625     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        13     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         6     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
